class GRest extends GObservable{constructor(t,e){super();this.t=[];this.s={};this.url=t.replace(/[\/]*$/,"/");this.authorization=e}endpoints(t){let e=this,s=this.t,i;if(!t)return s;this.t=Array.from(new Set(s.concat(t)));t.forEach(t=>{if(e[t])return;i=t.toLowerCase().split(/\W/).map((t,e)=>e==0?t:t.charAt(0).toUpperCase()+t.slice(1)).join("");e[i]=new GRestEndpoint(t,e)});return e}headers(t){let e=this.s;if(!t)return e;Object.assign(this.s,t);Object.entries(e).forEach(([t,e])=>typeof e=="undefined"||e==null?delete this.s[t]:1);return this}release(){let t=this;Object.keys(t).forEach(e=>{if(t[e]instanceof GRestEndpoint){t[e].release()}delete t[e]})}}class GRestEndpoint{constructor(t,e){this.name=t;this.i=e;this.h=e.url+t+"/"}http(t,e){let s=this.i,i=s.authorization,h=t.headers=Object.assign({},s.headers(),t.headers||{});h["X-Requested-With"]="XMLHttpRequest";if(i&&!h.Authorization){h.Authorization=i}t.url=this.h;let n=typeof e;if(n=="object"){t.params=e}else if(n!="undefined"){t.url+=e}t.endpoint=this.name;return new GRestRequest(t,this.api)}get(t){return this.u("get",t)}post(t,e){return this.l("post",t,e)}put(t,e){return this.l("put",t,e)}delete(t){return this.u("delete",t)}u(t,e){return this.http({method:t},e)}l(t,e,s){if(!s){s=e;e=null}return this.http({method:t,data:s},e)}release(){delete this.name;delete this.i}}class GRestRequest{constructor(t,e){this.o=t;this.p=e;this.R={endpoint:t.endpoint||null,method:t.method};this.again()}again(){this.G("pending");this.g=undefined;this.j=undefined;this.O=[];this.m=[];axios(this.o).then(t=>{let e=[t.data,{status:t.status,headers:t.headers}];this.g=e;try{this.O.forEach(t=>t(e[0],e[1]))}catch(t){console.log(t)}this.O=[];this.G("ok")}).catch(t=>{let e={message:t.message||"Network Error"},s=t.response;if(s){e.message=s.statusText||"Error";["data","status","headers"].forEach(t=>e[t]=s[t])}this.j=e;this.m.forEach(t=>t(e));this.m=[];this.G("fail")});return this}ok(t){let e=this.g;typeof e!="undefined"?t(e[0],e[1]):this.O.push(t);return this}fail(t){let e=this.j;typeof e!="undefined"?t(e):this.m.push(t);return this}G(t){if(this.p){this.R.status=t;this.p.notify(this.R)}}}